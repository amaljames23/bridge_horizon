{% include 'user_header.html' %}

<style>
  /* Styling for the seat grid container */
  .seat-grid {
    display: grid;
    grid-template-columns: repeat(
      auto-fill,
      60px
    ); /* Automatically fit as many columns as possible */
    gap: 10px; /* Add spacing between seats */
    justify-content: center;
    align-items: center;
    margin-top: 20px;
  }

  /* Styling for each seat */
  .seat {
    width: 60px; /* Seat width */
    height: 60px; /* Seat height */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    color: white;
    font-weight: bold; /* Ensure text is bold */
  }

  /* Available seat styling (green) */
  .seat.available {
    background-color: green;
  }

  /* Pending seat styling (yellow) */
  .seat.pending {
    background-color: yellow;
    color: black; /* Pending seat text color */
  }

  /* Booked seat styling (red) */
  .seat.booked {
    background-color: red;
  }

  /* Styling for selected seat (blue) */
  .seat.selected {
    background-color: blue !important;
  }

  /* Styling for the book button */
  #book-btn {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4caf50;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 20px;
    border-radius: 5px;
    transition: background-color 0.3s ease;
  }

  #book-btn:hover {
    background-color: #45a049;
  }
</style>

<h1>Book Seats</h1>
<div
  class="seat-grid"
  id="seat-container"
  data-screening-slot="{{ screening_slot_id }}"
>
  {% for seat in seats %}
  <div
    class="seat {% if seat.status == 'available' %}available{% else %}pending{% endif %}"
    data-seat-id="{{ seat.seat_id }}"
  >
    {{ seat.seat_number }}
  </div>
  {% endfor %}
</div>

<!-- Total Amount Display -->
<button id="book-btn">Book Seats (â‚¹<span id="total-price">0</span>)</button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let selectedSeats = [];
    let seatPrice = 150; // Price per seat

    // Add event listener to each available seat
    document.querySelectorAll(".seat.available").forEach((seat) => {
        seat.addEventListener("click", function () {
            let seatId = this.getAttribute("data-seat-id");

            if (this.classList.contains("selected")) {
                // If seat is already selected, remove it
                this.classList.remove("selected");
                selectedSeats = selectedSeats.filter((id) => id !== seatId);
            } else {
                // If seat is not selected, add it
                this.classList.add("selected");
                selectedSeats.push(seatId);
            }

            // Update the total price
            updateTotalPrice();
        });
    });

    // Function to update the total price based on selected seats
    function updateTotalPrice() {
        let totalPrice = selectedSeats.length * seatPrice;
        document.getElementById("total-price").textContent = totalPrice;
    }

    // Handle the booking button click
    document.getElementById("book-btn").addEventListener("click", function () {
        if (selectedSeats.length === 0) {
            alert("Please select at least one seat!");
            return;
        }

        let screeningSlotId = document
            .getElementById("seat-container")
            .getAttribute("data-screening-slot");

        let requestData = {
            seats: selectedSeats,
            total_amount: selectedSeats.length * seatPrice,
            screening_slot_id: screeningSlotId,
        };

        // Sending the selected seats data to the backend for confirmation
        fetch("/user_seat_confirm/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(requestData),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    alert("Seats booked successfully!");
                    location.reload(); // Reload the page after successful booking
                } else {
                    alert("Booking failed! " + (data.error || "Try again later."));
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while booking seats.");
            });
    });
});

</script>

{% include 'footer.html' %}
